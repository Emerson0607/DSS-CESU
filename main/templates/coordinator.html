{% extends "admin_dashboard.html" %}
{% block content %}

<div class="coordinatorCard">
    <div class="insights-div">

        <span class="material-symbols-sharp ">analytics </span>
        <h2 style="display:inline;" class="ml-4 lh-base text-capitalize fs-2 fw-medium " ></h2>
        
        <div class="middle">
            <div class="left">
                <h3></h3>
                <h1></h1>
            </div>
            <div class="progress">
                <svg>
                    <circle cx='38' cy='38' r='36'></circle>
                </svg>
                <div class="number">
                    <p></p>
                </div>
            </div>
        </div>
        <small class="text-muted"></small>
          <!-- Add checkboxes and labels here -->
        <div class="checkboxes">
            <p>Checkboxes:</p>
            <div class="checkbox-group">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="" value="">
                    <label class="label" ></label>
                </div>

            </div>

        </div>


      

    </div>

</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

<script>
    $(document).ready(function(){
        function_name();
    });

    function function_name(){
        $.ajax({
        url: "/get_community_data",
        method: "GET",
        dataType: "json",
        success: function(data) {
            // Get the container where you want to append the generated divs
        var insightsContainer = $(".coordinatorCard");
    
        // Iterate through the data and generate div elements for each record
        data.forEach(function(record) {
        // Clone the template .insights-div element for each record
        var insightsDiv = $(".insights-div").clone();

        // Update the content within the newly created insights-div
        insightsDiv.find("h3").text(record.community);
        insightsDiv.find("h2").text(record.user);
        insightsDiv.find("h1").text(record.program);
        insightsDiv.find(".text-muted").text(record.subprogram);
     

            // Generate checkboxes based on the totalWeek value
            var checkboxGroup = insightsDiv.find(".checkbox-group");
            checkboxGroup.empty(); // Clear any existing checkboxes

            var lastCheckedIndex = 0; // Keep track of the last checked checkbox index

            for (var i = 1; i <= record.totalWeek; i++) {
                var checkboxContainer = $('<div class="form-check form-check-inline">');
                var checkbox = $('<input class="form-check-input" type="checkbox">');
                var label = $('<label class="label">Week ' + i + '</label>');

                // Set a unique ID for each checkbox, e.g., "checkbox1", "checkbox2", ...
                var checkboxId = "checkbox" + i + record.subprogram;
                checkbox.attr("id", checkboxId);
                
                // Set the "for" attribute of the label to match the checkbox's ID
                label.attr("for", checkboxId);

    
                // Append the checkbox to the container, and the container to the checkboxGroup
                checkboxContainer.append(checkbox);
                checkboxContainer.append(label);


                // Check and disable checkboxes up to record.week
                if (i <= record.week) {
                
                    checkbox.prop("checked", true);

                }else {
                    checkbox.prop("disabled", true);
                }

               

                checkbox.on("change", function() {
                if (this.checked) {
                    var currentIndex = i;
                 
                    lastCheckedIndex = currentIndex;
                } else {
                    this.checked = true;
                }
            });


            checkboxGroup.append(checkboxContainer);
        } //end for

        var checkboxes = checkboxGroup.find("input:checkbox");

        checkboxes.on("change", function () {
            if (this.checked) {
                var currentIndex = checkboxes.index(this);
                console.log(currentIndex);

                // Enable the next checkbox if it exists and is not already checked
                if (currentIndex < checkboxes.length - 1) {
                    var nextCheckbox = checkboxes.eq(currentIndex + 1);
                    if (!nextCheckbox.prop("checked")) {
                        nextCheckbox.prop("disabled", false);
                    }
                }
            }
        });


         // Calculate the percentage and format it as a whole number with a percentage sign
        var percentage = Math.floor((record.week * 100 / record.totalWeek));
        insightsDiv.find(".number").text(percentage + "%") ;

        // Calculate the circumference of the circle
        var circle = insightsDiv.find("circle");
        var circumference = 2 * Math.PI * parseInt(circle.attr("r"));

        // Calculate the dash-offset based on the percentage
        var dashOffset = circumference * (1 - percentage / 100);

        // Set the 'stroke-dasharray' and 'stroke-dashoffset' properties
        circle.attr("stroke-dasharray", circumference);
        circle.attr("stroke-dashoffset", dashOffset);

        // Set color based on percentage
        if (percentage >= 85) {
            circle.attr("stroke", "#41f1b6"); // Green
            } else if (percentage >= 70) {
            circle.attr("stroke", "#ffbb55"); // Orange
            } else if (percentage >= 40) {
            circle.attr("stroke", "#ff7782"); // Pink
            } else {
            circle.attr("stroke", "red"); // Red
            }

        insightsContainer.append(insightsDiv);
        insightsDiv.removeClass("insights-div");
    });

        //hide the dafault container
        insightsContainer.find("> div:first-child").css("display", "none");
    },
    error: function() {
        // Handle errors here if the request fails
        console.log("Failed to load community data.");
    }
    });
    }
</script>
{% endblock %}